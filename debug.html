<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Debug - Instituto UP</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug { background: #f0f0f0; padding: 20px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 15px 30px; font-size: 16px; margin: 10px; cursor: pointer; }
        .webhook-test { background: #fff3e0; padding: 20px; }
    </style>
</head>
<body>
    <h1>üîß Debug - Instituto UP</h1>
    
    <div class="debug">
        <h3>üìä Status do Sistema</h3>
        <p id="status">Carregando...</p>
    </div>
    
    <div class="webhook-test">
        <h3>üì° Teste de Webhook</h3>
        <button onclick="testarWebhook()">Testar Webhook Direto</button>
        <div id="webhookResult"></div>
    </div>
    
    <div class="debug">
        <h3>üéØ Teste do Question√°rio</h3>
        <button onclick="window.location.href='questionario.html'">Abrir Question√°rio</button>
    </div>
    
    <div class="debug">
        <h3>üìã Logs do Console</h3>
        <div id="consoleLogs"></div>
    </div>

    <script>
        console.log('üîß P√°gina de debug carregada');
        
        // Capturar logs do console
        const originalLog = console.log;
        const originalError = console.error;
        const logsContainer = document.getElementById('consoleLogs');
        
        function addLogToPage(type, ...args) {
            const logDiv = document.createElement('div');
            logDiv.className = type === 'error' ? 'error' : 'success';
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${args.join(' ')}`;
            logsContainer.appendChild(logDiv);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLogToPage('log', ...args);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLogToPage('error', ...args);
        };
        
        // Teste de webhook direto
        async function testarWebhook() {
            console.log('üß™ Testando webhook...');
            const resultDiv = document.getElementById('webhookResult');
            resultDiv.innerHTML = '<p>Enviando...</p>';
            
            try {
                const testData = {
                    client_id: 'test_' + Date.now(),
                    timestamp: new Date().toISOString(),
                    step_completed: 0,
                    test: true,
                    message: 'Teste direto do webhook'
                };
                
                console.log('üì§ Dados de teste:', testData);
                
                const response = await fetch('https://up-n8n.welzbd.easypanel.host/webhook/a90b965c-7606-43eb-9d80-18e99bbd6718', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                console.log('üì° Response status:', response.status);
                const responseText = await response.text();
                console.log('üì° Response text:', responseText);
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <p>‚úÖ Webhook funcionando!</p>
                            <p>Status: ${response.status}</p>
                            <p>Response: ${responseText}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <p>‚ùå Erro no webhook</p>
                            <p>Status: ${response.status}</p>
                            <p>Response: ${responseText}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå Erro no teste:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <p>‚ùå Erro de conex√£o</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Status do sistema
        document.addEventListener('DOMContentLoaded', function() {
            const statusEl = document.getElementById('status');
            
            // Verificar se arquivos principais existem
            const checks = [
                { name: 'script-simples.js', test: () => typeof sendWebhook !== 'undefined' },
                { name: 'questionario.html', test: () => true }
            ];
            
            let status = '‚úÖ Sistema carregado\n';
            status += `üìç URL atual: ${window.location.href}\n`;
            status += `üïí Timestamp: ${new Date().toISOString()}\n`;
            
            statusEl.innerHTML = `<pre>${status}</pre>`;
            
            console.log('‚úÖ Debug page inicializada');
        });
    </script>
</body>
</html>